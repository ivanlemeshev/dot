#!/usr/bin/env bash

set -euo pipefail

GREEN="\033[0;32m"
RESET="\033[0m"

echo ""
cat <<EOF
${GREEN}   ____   ___ _____ _____ ___ _     _____ ____
  |  _ \ / _ \_   _|  ___|_ _| |   | ____/ ___|
  | | | | | | || | | |_   | || |   |  _| \___ \
 _| |_| | |_| || | |  _|  | || |___| |___ ___) |
(_)____/ \___/ |_| |_|   |___|_____|_____|____/${RESET}
EOF
echo ""

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

source "$PROJECT_ROOT/lib/log.sh"
source "$PROJECT_ROOT/lib/print.sh"

OS="$(uname -s)"

if [[ "$OS" == "Linux" && -f /etc/os-release ]]; then
  # Load OS information for Linux that contains the OS $NAME and $VERSION_ID
  source /etc/os-release
  OS="$NAME $VERSION_ID"
fi

print_key_value "OS" "$OS"

case "$OS" in
  "Ubuntu 24.04")
    if [[ -f "$PROJECT_ROOT/bin/setup-ubuntu.sh" ]]; then
      source "$PROJECT_ROOT/bin/setup-ubuntu.sh"
    else
      log_fatal "setup-ubuntu.sh not found" 1
    fi
    ;;
  "Darwin"*)
    if [[ -f "$PROJECT_ROOT/bin/setup-macos.sh" ]]; then
      source "$PROJECT_ROOT/bin/setup-macos.sh"
    else
      log_fatal "setup-macos.sh not found" 1
    fi
    ;;
  *)
    log_fatal "Unsupported OS: $OS" 1
    ;;
esac
