name: Test Ubuntu Setup

on:
  push:
    paths:
      - "v2/**"
  pull_request:
    paths:
      - "v2/**"
  workflow_dispatch:

jobs:
  test-ubuntu:
    name: Test on Ubuntu 24.04
    runs-on: ubuntu-24.04

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build Docker image
        working-directory: v2
        run: docker build -t dotfiles-v2-test .

      - name: Verify Docker build succeeded
        run: docker images dotfiles-v2-test

      - name: Run interactive test
        run: |
          docker run --rm dotfiles-v2-test fish --version
          docker run --rm dotfiles-v2-test nvim --version
          docker run --rm dotfiles-v2-test tmux -V
          docker run --rm dotfiles-v2-test starship --version
          docker run --rm dotfiles-v2-test git --version
          docker run --rm dotfiles-v2-test bat --version

      - name: Verify symlinks
        run: |
          docker run --rm dotfiles-v2-test test -L /home/testuser/.config/fish/config.fish
          docker run --rm dotfiles-v2-test test -L /home/testuser/.config/nvim
          docker run --rm dotfiles-v2-test test -L /home/testuser/.tmux.conf
          docker run --rm dotfiles-v2-test test -L /home/testuser/.config/starship.toml
          docker run --rm dotfiles-v2-test test -L /home/testuser/.vimrc
